<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/app-layout/app-layout.html">
<link rel="import" href="../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="../bower_components/app-layout/app-scroll-effects/effects/waterfall.html">
<link rel="import" href="../bower_components/app-layout/app-drawer/app-drawer.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/app-pouchdb/pouchdb.html">
<link rel="import" href="../bower_components/app-pouchdb/app-pouchdb-document.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-input/paper-textarea.html">
<link rel="import" href="../bower_components/paper-spinner/paper-spinner.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../bower_components/paper-menu-button/paper-menu-button.html">
<link rel="import" href="../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../bower_components/paper-dialog-scrollable/paper-dialog-scrollable.html">
<link rel="import" href="../bower_components/iron-dropdown/iron-dropdown-scroll-manager.html">


<link rel="import" href="shared-styles.html">
<!-- <script src="../bower_components/jsoneditor/dist/jsoneditor.min.js"></script> -->

<script src="underscore-min.js"></script>

<dom-module id="rebelcricket-admin">

  <template>

    <style is="custom-style" include="shared-styles">

      :host {
        --primary-color: red;
        --default-primary-color: red;
      }

      #adminContent {
        margin-top: 150px;
        margin-left: 256px;
      }

      .drawer-button {
        margin: 1em;
      }

      #headerToolbar {
        padding-left: 1.5em;
      }



      .main-menu-bar h4{
        float: left;
      }

      app-toolbar {
        padding: 0;
        
      }
    
      app-header {
        background-color: rgba(255,255,255,0.9);
      }
  

      paper-button.custom, paper-fab.custom {
        background: rgba(255,0,0,0.8);
        
        margin: 0.5em;
        display: inline-block;
      }

      paper-button.adm_drwr{
        display: inline-block;
      }
      paper-button.adm_drwr:hover {
        background: rgba(255,0,0,0.8);
        color: white;
      }
      
      paper-fab.custom {
        font-size:1.5em;
        line-height: 1em;
      }

      paper-button.custom:hover, paper-fab.custom:hover {
        background: red;
        color: black;
      }

      .rebel-image{
        max-height: 150px;
        max-width: 150px;
      }

      .description-item {
        margin: 2em;
      }

      #jsoneditor {
        height: 100%;
        width: 99%;
      }
      ol, ul {
        list-style: none;
      }

      img.attachment {
        max-height: 175px;
        max-width: 175px;
        padding-top: 30px;
      }

      .current-page {
        width: 1em;
        height: 100%;
        background-color: red;
      }

      #vendorGoodsFilePicker, #savePageButton {
        margin-left: 2em;
        margin-right: 2em;
        display: inline-block;

      }

      .rightrow {
     
        padding-top: 2.5em;
        padding-bottom: 1.5em;
        /*min-width: 300px;*/
        width: 100%;
      }

      .drawerItemSelected{
        background-color: red;
      }

      .saveVendorGoodsRow{
        padding-top:1.5em;
        padding-bottom:1.5em;
      }
      /* vendorItem stylez*/
      .subtitle {
        background-color: rgba(255,255,255,0.8);
        color: black;
        margin-left: 0.5em;
        padding-left: 0.5em;
        padding-right: 0.5em;
      }



      .left{
        width: 350px;
        overflow-x: hidden;
        overflow-y: scroll;
        padding: 1em;
      }



      .color-img{
        margin-top: 8px;
        margin-bottom: 1em;
        word-wrap: break-word;
        -webkit-clip-path: polygon(0% 0%, 95% 0, 100% 50%, 95% 100%, 0% 100%);
        clip-path: polygon(0% 0%, 95% 0, 100% 50%, 95% 100%, 0% 100%);
      }

      .color-price{
        display: inline-block;
        margin-right: 1em;
      }

      #vendorGoodsInfo img {
        float: left;
        max-height: 200px;
        max-width: 200px;
      }
      /* END vendorItem stylez*/

      #dataLoadingSpinner {
        margin-top: 10px;
      }

      @media (max-width: 767px) {
        #adminContent {
          margin-top: 150px;
          margin-left: 0;
        }
      }
    </style>

    <app-pouchdb-document
      db-name="admin"
      doc-id="admin"
      data="{{admin}}">
    </app-pouchdb-document>

    <iron-ajax
      id="ajaxValidateApiKey"
      url="http://beta.rebelcricket.com/api/validate_api_key"
      headers='{{headers}}'
      handle-as="json"
      on-response="_handleValidateApiKeyResponse">
    </iron-ajax>

    
    <iron-ajax
      id="ajaxFetchQuote"
      url="http://beta.rebelcricket.com/api/quote"
      headers='{{headers}}'
      handle-as="json"
      on-response="_handleFetchQuoteResponse"
      last-response="{{quote}}"
      debounce-duration="500">
    </iron-ajax>

    <iron-ajax
      id="ajaxGetHomePage"
      url="http://beta.rebelcricket.com/api/pages"
      params='{"page":"home"}'
      headers='{{headers}}'
      handle-as="json"
      last-response="{{homePage}}">
    </iron-ajax>

    <iron-ajax
      id="ajaxGetAboutPage"
      url="http://beta.rebelcricket.com/api/pages"
      params='{"page":"about"}'
      headers='{{headers}}'
      handle-as="json"
      last-response="{{aboutPage}}">
    </iron-ajax>

    <iron-ajax
      id="ajaxGetServicesPage"
      url="http://beta.rebelcricket.com/api/pages"
      params='{"page":"services"}'
      headers='{{headers}}'
      handle-as="json"
      last-response="{{servicesPage}}">
    </iron-ajax>

    <iron-ajax
      id="ajaxUpdatePage"
      url="http://beta.rebelcricket.com/api/pages"
      method="POST"
      headers='{{headers}}'
      handle-as="json"
      content-type="application/json"
      on-response="_handleUpdatePageResponse">
    </iron-ajax>

    <iron-ajax
      id="ajaxGetImages"
      url="http://beta.rebelcricket.com/api/images"
      headers='{{headers}}'
      handle-as="json"
      last-response="{{images}}">
    </iron-ajax>

    <iron-ajax
      id="ajaxCreateImage"
      url="http://beta.rebelcricket.com/api/create_image"
      method="POST"
      headers='{{headers}}'
      on-response="_handleAjaxCreateImagePostResponse"
      on-error="_handleAjaxCreateImagePostError"
      >
    </iron-ajax>

    <iron-ajax
      id="ajaxVendorGoods"
      url="http://beta.rebelcricket.com/api/vendorgoods"
      handle-as="json"
      headers='{{headers}}'
      debounce-duration="500"
      on-response="_handleVendorGoodsResponse">
    </iron-ajax>

    <iron-ajax
      auto
      url="http://beta.rebelcricket.com/api/vendorgoods"
      params='{"datafiles":"true"}'
      handle-as="json"
      headers='{{headers}}'
      debounce-duration="500"
      last-response="{{vendorDatafiles}}">
    </iron-ajax>
    
    <iron-ajax
      auto
      url="http://beta.rebelcricket.com/api/vendorgoods"
      params='{"existingdata":"true"}'
      handle-as="json"
      headers='{{headers}}'
      debounce-duration="500"
      last-response="{{selectedVendorGoods}}">
    </iron-ajax>

    <iron-ajax
      id="saveVendorGoods"
      url="http://beta.rebelcricket.com/api/vendorgoods"
      method="POST"
      headers='{{headers}}'
      content-type="application/json"
      handle-as="json"
      on-response="_handlesaveVendorGoodsResponse"
      on-error="_handlesaveVendorGoodsError"
      >
    </iron-ajax>

    <paper-dialog id="vendorGoodsInfo">
      <paper-dialog-scrollable>
        <div class="detail-content row">
          
          <div class="row">

            <div class="col s12 center">
              <h5>[[vendorItem.title]]</h5>
              <h6>[[vendorItem.prod_id]] [[vendorItem.category]] [[vendorItem.sub_item]]</h6>
            </div>
          </div>

          <div class="row">
          
            <template is="dom-if" if="[[vendorItem.prod_id]]">
              <div class="col s12 m2 center">
                <img src$="http://cdn.companycasuals.com/cache/cc/[[vendorItem.prod_id]].jpg">
              </div>
            </template>

            <div class="col s12 m5 center">
              <p>[[vendorItem.prod_desc_text]]</p>
            </div>
            <div class="col s12 m5">
              <ul>
                <template is="dom-repeat" items="[[vendorItem.prod_desc_items]]">
                  <li>[[item]]</li>
                </template>
              </ul>
            </div>

          </div>

          <div class="row">
            <div class="col s4 m3 l2">
             Select Color(s)
            </div>
            <div class="col s8 m9 l10">
              Sizes &amp; Prices
            </div>

          </div>

          <template is="dom-repeat" items="[[vendorItem.colors]]">
            <div class="row">
              <div class="col s4 m3 l2 color-img" style$="background-color: none;background: url([[item.href]]);">
                <div class="subtitle">
                  [[item.name]]
                </div>
              </div>
              <div class="col s8 m9 l10">
                <template is="dom-repeat" items="[[_colorPricesForName(vendorItem, item.name)]]" as="colorPrices">
                  
                  <span class="color-price center">[[colorPrices.size]]<br>[[colorPrices.price]]</span>
                  
                </template>
              </div>
            </div>
          </template>
          

        </div>


      </paper-dialog-scrollable>
      <!-- <div class="buttons">
        <paper-button class="custom">I don't know</paper-button>
        <paper-button class="custom">Something else</paper-button>
      </div> -->
    </paper-dialog>

    <app-drawer-layout fullbleed>
      <app-drawer>
        <div style="height: 100%; overflow: auto;">
          <app-toolbar><span id="headerToolbar">Admin</span></app-toolbar>
          <div id="drawerButtonsContainer" hidden>
            <div class="drawer-button">
              <span id="QuoteSelected" class="drawerItemSelected" hidden>&nbsp;</span>
              <paper-button class="adm_drwr" on-tap="_setCurrentPage" page="Quote">Quotes</paper-button>
            </div>
            <div class="drawer-button">
              <span id="GoodsSelected" class="drawerItemSelected" hidden>&nbsp;</span>
              <paper-button class="adm_drwr" on-tap="_setCurrentPage" page="Vendor Goods">Vendor Goods</paper-button>
            </div>
            <div class="drawer-button">
              <span id="ImagesSelected" class="drawerItemSelected" hidden>&nbsp;</span>
              <paper-button class="adm_drwr" on-tap="_setCurrentPage" page="Images">Images</paper-button>
            </div>
            <div class="drawer-button">
              <span id="HomeSelected" class="drawerItemSelected" hidden>&nbsp;</span>
              <paper-button class="adm_drwr" on-tap="_setCurrentPage" page="Home">Home</paper-button>
            </div>
            <div class="drawer-button">
              <span id="AboutSelected" class="drawerItemSelected" hidden>&nbsp;</span>
              <paper-button class="adm_drwr" on-tap="_setCurrentPage" page="About">About</paper-button>
            </div>
            <div class="drawer-button">
              <span id="ServicesSelected" class="drawerItemSelected" hidden>&nbsp;</span>
              <paper-button class="adm_drwr" on-tap="_setCurrentPage" page="Services">Services</paper-button>
            </div>
            <div class="drawer-button">
              <span id="KeySelected" class="drawerItemSelected">&nbsp;</span>
              <paper-button class="adm_drwr" on-tap="_setCurrentPage" page="Api Key">Api Key</paper-button>
            </div>
          </div>
        </div>
      </app-drawer>
      <app-header-layout>
        <app-header reveals effects="waterfall">
          <app-toolbar>
            <paper-icon-button icon="menu" drawer-toggle></paper-icon-button>
            
            <div main-title>
                <template is="dom-if" if="[[_isServices(currentPage)]]">
                  ([[servicesPage.items.length]])
                </template>
                 <template is="dom-if" if="[[_isVendorGoods(currentPage)]]">
                    [[filteredGoodsLength]]
                </template>
            </div>
            <div class="row rightrow">

   
              <div class="center" hidden$="[[!_isImages(currentPage)]]">
                
                <label for="rebelImages">&nbsp;Upload Image file</label>
                <input id="rebelImages" type="file">

                <paper-spinner id="rebelImagesSpinner" alt="Uploading File..."></paper-spinner>
                <span id="rebelImagesFeedback"></span>
              </div>
          
              <template is="dom-if" if="[[_isQuote(currentPage)]]">
                <div class="col s12 m6 offset-m3 center">
                  <paper-input label="Quote Number" value="{{admin.quoteID}}"></paper-input>
                </div>
              </template>

              <template is="dom-if" if="[[_isVendorGoods(currentPage)]]">
                
                <div id="vendorGoodsFilePicker">
                  <div class="col s2">
                    <paper-button class="custom" on-tap="_saveVendorData">Save</paper-button>
                  </div>
                  <div class="col s2">
                    <paper-button class="adm_drwr" on-tap="_showSelected">([[selectedVendorGoods.length]])</paper-button>
                  </div>
                  <div class="col s3">
                    <paper-input id="vendorDataFilter" value="{{admin.VendorDataFilter}}" label="Filter"></paper-input>
                  </div>
                  <div class="col s2">
                    <paper-button class="adm_drwr" on-tap="_applyVendorDataFilter">Filter</paper-button>
                  </div>
                  <div class="col s3">
                    <paper-dropdown-menu label="Load Data File..." on-iron-select="_dataFileSelected" hidden$="[[dataLoading]]">
                      <paper-listbox class="dropdown-content">
                        <paper-item class="custom">Load Data File...</paper-item>
                        <template is="dom-repeat" items="{{vendorDatafiles}}">
                          <paper-item class="custom" value="[[item]]">[[item]]</paper-item>
                        </template>
                      </paper-listbox>
                    </paper-dropdown-menu>

                    <paper-spinner id="dataLoadingSpinner" active$="[[dataLoading]]" hidden$="[[!dataLoading]]"></paper-spinner>
                  </div>

                </div>
              </template>

              <template is="dom-if" if="[[isPages]]">
                <div id="savePageButton">
                  <paper-button class="custom" on-tap="_savePage">Save Page</paper-button>
                </div>
              </template>
          </div>
          </app-toolbar>
        </app-header>

        

        <div id="apiKeyContainer" hidden>
          <div class="row">
            <div class="col s12 m8 offset-m2">
              <paper-input label="Api Key" value="{{admin.apiKey}}"></paper-input>
            </div>

          </div>
        </div>

        <div id="quotesContainer" hidden>
          <!-- <rebelcricket-quote quote="[[quote]]" quote-id="[[quoteID]]"></rebelcricket-quote> -->
        </div>

        <div id="vendorGoodsContainer" hidden>
          <!-- <div id="jsoneditor"></div> -->
     <!--      <div class="row saveVendorGoodsRow">
            <div class="col s12 center">
              
            </div>
          </div> -->
          <template is="dom-if" if="[[filteredVendorgoods.length]]">
            <div>
              <paper-checkbox checked={{selectAll}} on-change="_selectAllFilteredGoods"></paper-checkbox>
              Select All
            </div>
          </template>
          <template is="dom-repeat" items="[[filteredVendorgoods]]">
            <div>
              <paper-checkbox checked={{item.selected}} on-change="_vendorGoodSelected"></paper-checkbox>
              <paper-icon-button icon="shopping-basket" on-tap="_openDialog"></paper-icon-button>
              [[item.title]]
            </div>
          </template>
        </div>

        <div id="homePageContainer" hidden>

          
          <template is="dom-if" if="[[homePage.attachments]]">
            <div class="row">
              <div class="s12">
                <h5>Image Carousel</h5>
              </div>
            </div>

            <template is="dom-repeat" items="{{homePage.attachments}}">
              <div class="row">
                <div class="col s4">
                  <img src="[[item.url]]" class="attachment">
                </div>
                <div class="col s6">
                  <ul>
                  <!-- <li><paper-input label="Caption" value="{{item.caption}}"></paper-input></li> -->
                  <li><paper-input label="URL" value="{{item.url}}"></paper-input></li>
                  <li><paper-input label="Link To" value="{{item.link_to}}"></paper-input></li>
                  <li>
                  <paper-fab mini on-tap="_removeHomePageAttachment" class="custom" label="&nbsp;&times;"></paper-fab>
                  </li>
                  </ul>
                </div>
              </div>
            </template>
            
            <div class="row">
              <div class="col s12 center">
                <paper-button class="custom" on-tap="_addHomePageAttachment">Add Another Image</paper-button>
              </div>
            </div>
          </template>
        </div>

        <div id="aboutPageContainer" hidden>
          
          <div class="row">
            <div class="col s12 m8 offset-m2">
              <paper-input label="Heading" value="{{aboutPage.heading}}"></paper-input>
            </div>

            <template is="dom-if" if="[[aboutPage.items]]">
              <div class="col s12 m8 offset-m2">
                <h5>Items</h5>
              </div>

              <template is="dom-repeat" items="{{aboutPage.items}}">

                <div class="col s12 m8 offset-m2">
                  <paper-input label="Title" value="{{item.title}}"></paper-input>
                  <paper-textarea label="Description" value="{{item.description}}"></paper-textarea>
                </div>

                <div class="col s12 m8 offset-m2">
                  <paper-fab mini on-tap="_removeAboutPageDescriptionItem" class="custom" label="&nbsp;&times;"></paper-fab>
                </div>
               
              </template>

              <div class="row description-item">
                <div class="col s12 m8 offset-m2">
                  <paper-button class="custom" on-tap="_addAboutPageDescriptionItem">Add Description Item</paper-button>
                </div>
              </div>
      
            </template>
          </div>
        </div>

        <div id="servicesPageContainer" hidden>
       
          <div class="row">
            <div class="col s12 m8 offset-m2">
              <paper-input label="Heading" value="{{servicesPage.heading}}"></paper-input>
            </div>

            <div class="col s12 m8 offset-m2">
              <h5>Items</h5>
            </div>
            <template is="dom-repeat" items="{{servicesPage.items}}">

              <div class="col s12 m8 offset-m2">
                <paper-input label="Name" value="{{item.name}}"></paper-input>
              </div>
              <div class="col s12 m8 offset-m2">
                <paper-input label="Slug" value="{{item.slug}}"></paper-input>
              </div>

              <div class="col s12 m8 offset-m2">
                <h6>Main Image</h6>
              </div>
              <div class="col s12 m8 offset-m2">
                <ul>
                <li><paper-input label="URL" value="{{item.image}}"></paper-input></li>
                </ul>
              </div>
        

              <div class="col s12 m8 offset-m2">
                <h6>Detail Images</h6>
              </div>
              <div class="col s12 m8 offset-m2">
                <ul>
                  <template is="dom-repeat" items="{{item.detail_images}}" as="detailImageItem">
                    <li>
                      <paper-input label="URL" value="{{detailImageItem}}"></paper-input>
                      <paper-fab mini on-tap="_removeServicesDetailImage" class="custom" label="&nbsp;&times;" idx$="[[_servicePageItemIndex(item)]]"></paper-fab>
                    </li>
                  </template>
                  <li><paper-button class="custom" on-tap="_addServicesDetailImage">Add Detail Image</paper-button></li>
                </ul>
              </div>
               
              <template is="dom-repeat" items="{{item.detail_items}}" as="descriptionItem">
                <div class="col s12 m8 offset-m2">
                  <paper-input label="Heading" value="{{descriptionItem.name}}"></paper-input>

                  <paper-textarea label="Description Item" value="{{descriptionItem.description}}"></paper-textarea>
                    
                </div>

                <div class="col s12 m8 offset-m2">
                  <paper-fab mini on-tap="_removeServicesDescriptionItem" class="custom" label="&nbsp;&times;"></paper-fab>
                </div>
              </template>

                

              <div class="row description-item">
                <div class="col s12 m8 offset-m2">
                  <paper-button class="custom" on-tap="_addServicesDescriptionItem">Add Description Item</paper-button>
                </div>
              </div>

              <div class="row description-item">
                <div class="col s12 m8 offset-m2">
                  <paper-button class="custom" on-tap="_removeService">Remove [[item.name]] Service</paper-button>
                </div>
              </div>
              
              <hr>
              
            </template>


            <div class="row">
              <div class="col s12 center">
                <paper-button class="custom" on-tap="_addService">Add Service</paper-button>
              </div>
            </div>


          </div>

        </div>      

        <div id="imagesContainer" hidden>
          
          <div class="row">
            <template is="dom-repeat" items="{{images}}">
              <div class="col s6 m4 l3">
                <img class="rebel-image" src$="[[item.url]]" on-tap="_imageSelected">
                <input value="[[item.url]]">
              </div>
            </template>
          </div>

        </div>

      </app-header-layout>
    </app-drawer-layout>
   
  </template>

  <script>

    var container, options, editor;

    Polymer({

      is: 'rebelcricket-admin',
      properties: {
        admin: {
          type: Object,
          notify: true,
          observer: '_adminObserver'
        },
        apiKey: {
          type: String,
          notify: true,
          value: function(){
            return '';
          }
        },
        quoteID: {
          type: String,
          notify: true,
          value: function() { 
            return window.location.hash.replace(/#/,'');
          }
        },
        quote: {
          type: Object,
          notify: true
        },
        headers: {
          type: Object,
          computed: '_header(apiKey)'
        },
        hasValidApiKey: {
          type: Boolean,
          notify: true,
          computed: '_validateApiKey(apiKey)'
        },
        filteredGoodsLength: {
          type: String, 
          notify: true,
          computed: '_filteredGoodsLength(filteredVendorgoods)'
        },
        homePage: {
          type: Object,
          notify: true
        },
        aboutPage: {
          type: Object,
          notify: true
        },
        servicesPage: {
          type: Object,
          notify: true
        },
        isPages: {
          type: Boolean,
          notify: true
        },
        currentPage: {
          type: String,
          notify: true,
          observer: '_currentPageChanged',
          value: function(){
            return 'Api Key';
          }
        },
        images: {
          type: Array,
          notify: true
        },
        vendorgoods: {
          type: Array,
          notify: true
        },
        filteredVendorgoods: {
          type: Array,
          notify: true
        },
        selectedVendorGoods: {
          type: Array,
          notify: true
        },
        vendorDatafiles: {
          type: Array,
          notify: true
        },
        vendorItem: {
          type: Object,
          notify: true
        },
        dataLoading: {
          type: Boolean,
          value: false
        },
        selectAll: {
          type: Boolean,
          value: false
        }
      },
      _header: function(_apiKey) {
        // console.log('_header _apiKey:',_apiKey);
        return {'Authorization': 'Token token="'+_apiKey+'"'};
      },
      _adminObserver: function(admin){
        if(admin.apiKey != undefined && admin.apiKey != ''){
          // console.log('api key from pouch:',admin.apiKey);
          if(this.apiKey != admin.apiKey){
            this._validateApiKey(admin.apiKey);
          }
        }
        if(admin.quoteID != undefined && admin.quoteID != ''){
          if(this.quoteID != admin.quoteID){
            this._fetchQuote(admin.quoteID);
          }
        }
      },
      _currentPageChanged: function(_currentPage){

        if(_currentPage === 'Api Key'){
          this.$.apiKeyContainer.hidden = false;
          this.$.quotesContainer.hidden = true;
          this.$.vendorGoodsContainer.hidden = true;
          this.$.homePageContainer.hidden = true;
          this.$.aboutPageContainer.hidden = true;
          this.$.servicesPageContainer.hidden = true;
          this.$.imagesContainer.hidden = true;
          
          this.$.KeySelected.hidden = false;
          this.$.QuoteSelected.hidden = true;
          this.$.GoodsSelected.hidden = true;
          this.$.HomeSelected.hidden = true;
          this.$.AboutSelected.hidden = true;
          this.$.ServicesSelected.hidden = true;
          this.$.ImagesSelected.hidden = true;

          this.set('isPages', false);
        }else if(_currentPage === 'Quote'){

          if(this.$$('rebelcricket-quote') == undefined){
            this.importHref('src/rebelcricket-quote.html', function(e) {
              // e.target.import is the import document.
              var quoteElem = document.createElement('rebelcricket-quote');
              // console.log('GONNA SET quoteID:',this.admin.quoteID);
              quoteElem.quoteID = this.admin.quoteID;
              quoteElem.quote = this.quote;
              Polymer.dom(this.$.quotesContainer).appendChild(quoteElem);  
            }, function(e) {
              // loading error
            });
          }

          this.$.apiKeyContainer.hidden = true;
          this.$.quotesContainer.hidden = false;
          this.$.vendorGoodsContainer.hidden = true;
          this.$.homePageContainer.hidden = true;
          this.$.aboutPageContainer.hidden = true;
          this.$.servicesPageContainer.hidden = true;
          this.$.imagesContainer.hidden = true;

          this.$.KeySelected.hidden = true;
          this.$.QuoteSelected.hidden = false;
          this.$.GoodsSelected.hidden = true;
          this.$.HomeSelected.hidden = true;
          this.$.AboutSelected.hidden = true;
          this.$.ServicesSelected.hidden = true;
          this.$.ImagesSelected.hidden = true;

          this.set('isPages', false);
        }else if(_currentPage === 'Vendor Goods'){

          // if(this.$$('rebelcricket-vendor') != undefined){
          //   // console.log('DONOT NEED TO IMPORT HREF FOR VENDOR!');
          // }else{
          //   // console.log('GONNA IMPORT HREF FOR VENDOR!');
          //   this.importHref('src/rebelcricket-vendor.html', function(e) {
          //     // e.target.import is the import document.
          //     var vendorElem = document.createElement('rebelcricket-vendor');
          //     // quoteElem.quoteID = this.quoteID
          //     // quoteElem.lineItem = this.lineItemForVendor; //lineItemForVendor
              
          //     Polymer.dom(this.$.vendorGoodsContainer).appendChild(vendorElem);  
          //   }, function(e) {
          //     // loading error
          //   });
          // }


          this.$.apiKeyContainer.hidden = true;
          this.$.quotesContainer.hidden = true;
          this.$.vendorGoodsContainer.hidden = false;
          this.$.homePageContainer.hidden = true;
          this.$.aboutPageContainer.hidden = true;
          this.$.servicesPageContainer.hidden = true;
          this.$.imagesContainer.hidden = true;

          this.$.KeySelected.hidden = true;
          this.$.QuoteSelected.hidden = true;
          this.$.GoodsSelected.hidden = false;
          this.$.HomeSelected.hidden = true;
          this.$.AboutSelected.hidden = true;
          this.$.ServicesSelected.hidden = true;
          this.$.ImagesSelected.hidden = true;

          this.set('isPages', false);
        }else if(_currentPage === 'Home'){
          this.$.ajaxGetHomePage.generateRequest();
          this.$.apiKeyContainer.hidden = true;
          this.$.quotesContainer.hidden = true;
          this.$.vendorGoodsContainer.hidden = true;
          this.$.homePageContainer.hidden = false;
          this.$.aboutPageContainer.hidden = true;
          this.$.servicesPageContainer.hidden = true;
          this.$.imagesContainer.hidden = true;

          this.$.KeySelected.hidden = true;
          this.$.QuoteSelected.hidden = true;
          this.$.GoodsSelected.hidden = true;
          this.$.HomeSelected.hidden = false;
          this.$.AboutSelected.hidden = true;
          this.$.ServicesSelected.hidden = true;
          this.$.ImagesSelected.hidden = true;

          this.set('isPages', true);
        }else if(_currentPage === 'About'){
          this.$.ajaxGetAboutPage.generateRequest();
          this.$.apiKeyContainer.hidden = true;
          this.$.quotesContainer.hidden = true;
          this.$.vendorGoodsContainer.hidden = true;
          this.$.homePageContainer.hidden = true;
          this.$.aboutPageContainer.hidden = false;
          this.$.servicesPageContainer.hidden = true;
          this.$.imagesContainer.hidden = true;

          this.$.KeySelected.hidden = true;
          this.$.QuoteSelected.hidden = true;
          this.$.GoodsSelected.hidden = true;
          this.$.HomeSelected.hidden = true;
          this.$.AboutSelected.hidden = false;
          this.$.ServicesSelected.hidden = true;
          this.$.ImagesSelected.hidden = true;

          this.set('isPages', true);
        }else if(_currentPage === 'Services'){
          this.$.ajaxGetServicesPage.generateRequest();
          this.$.apiKeyContainer.hidden = true;
          this.$.quotesContainer.hidden = true;
          this.$.vendorGoodsContainer.hidden = true;
          this.$.homePageContainer.hidden = true;
          this.$.aboutPageContainer.hidden = true;
          this.$.servicesPageContainer.hidden = false;
          this.$.imagesContainer.hidden = true;

          this.$.KeySelected.hidden = true;
          this.$.QuoteSelected.hidden = true;
          this.$.GoodsSelected.hidden = true;
          this.$.HomeSelected.hidden = true;
          this.$.AboutSelected.hidden = true;
          this.$.ServicesSelected.hidden = false;
          this.$.ImagesSelected.hidden = true;

          this.set('isPages', true);
        }else if(_currentPage === 'Images'){
          this.$.ajaxGetImages.generateRequest();
          this.$.apiKeyContainer.hidden = true;
          this.$.quotesContainer.hidden = true;
          this.$.vendorGoodsContainer.hidden = true;
          this.$.homePageContainer.hidden = true;
          this.$.aboutPageContainer.hidden = true;
          this.$.servicesPageContainer.hidden = true;
          this.$.imagesContainer.hidden = false;

          this.$.KeySelected.hidden = true;
          this.$.QuoteSelected.hidden = true;
          this.$.GoodsSelected.hidden = true;
          this.$.HomeSelected.hidden = true;
          this.$.AboutSelected.hidden = true;
          this.$.ServicesSelected.hidden = true;
          this.$.ImagesSelected.hidden = false;

          this.set('isPages', false);
        }
      },
      _setCurrentPage: function(e){
        // console.log('_setCurrentPage e.target.getAttribute(page):',e.target.getAttribute('page'));
        this.set('currentPage', e.target.getAttribute('page'));
      },
      _validateApiKey: function(apiKey){
        // console.log('_validateApiKey: ',apiKey == undefined || apiKey == '');
        this.set('apiKey', apiKey);
        //return apiKey == undefined || apiKey == '';
        this.$.ajaxValidateApiKey.generateRequest();
      },
      _fetchQuote: function(_quoteID){
        this.set('quoteID',_quoteID);

        var params = {};
        params["quote_number"] = _quoteID;
        this.$.ajaxFetchQuote.params = params;

        this.$.ajaxFetchQuote.generateRequest();
      },_handleFetchQuoteResponse: function(e){
        // console.log('_handleFetchQuoteResponse e:',e);
        // console.log('this.quote:',this.quote);
        this.$$('rebelcricket-quote').quoteID = this.quoteID;
        this.$$('rebelcricket-quote').quote = e.detail.response;
      },
      _fetchVendorGoods: function(_selected){
        var params = {};
        params["selected"] = _selected;
        this.$.ajaxVendorGoods.params = params;
        this.$.ajaxVendorGoods.generateRequest();
      },
      _handleVendorGoodsResponse: function(e){

        this.set('vendorgoods',e.detail.response);
        // editor.set(e.detail.response);
        this.set('filteredVendorgoods', e.detail.response);
        // get json
        this.set('dataLoading', false);
        this.set('selectAll', false);
      },
      _toggleDrawer: function(e){
        this.$.drawer.toggle();
      },
      _handleValidateApiKeyResponse: function(e){
        // console.log('_handleValidateApiKeyResponse e.detail.xhr.statusText:',e.detail.xhr.statusText);
        if(e.detail.xhr.statusText === 'OK'){
          this.$.drawerButtonsContainer.hidden = false;
          this.set('currentPage', 'Home');
        }
      },
      _handleUpdatePageResponse: function(e){
         // console.log('_handleUpdatePageResponse e.detail.xhr.statusText:',e.detail.xhr.statusText);
      },
      _handleAjaxCreateImagePostResponse: function(e){
        // console.log('_handleAjaxCreateImagePostResponse e:',e);
        this.$.rebelImagesSpinner.active = false;
        this.$.ajaxGetImages.generateRequest();
      },
      _handleAjaxCreateImagePostError: function(e){
        // console.log('_handleAjaxCreateImagePostError e:',e);
        this.$.rebelImagesSpinner.active = false;
      },
      _savePage: function(e){
        // console.log('_savePages e:',e);

        var params = {};
        
        if(this.currentPage == 'Home'){
          params["page"] = 'home';
          this.$.ajaxUpdatePage.body = {data: this.homePage};
        }else if(this.currentPage == 'About'){
          params["page"] = 'about';
          this.$.ajaxUpdatePage.body = {data: this.aboutPage};
        }else if(this.currentPage == 'Services'){
          params["page"] = 'services';
          // params["data"] = ; 
          this.$.ajaxUpdatePage.body = {data: this.servicesPage};
        }

        this.$.ajaxUpdatePage.params = params;
        this.$.ajaxUpdatePage.generateRequest();
      },
      _addHomePageAttachment: function(e){
        this.push('homePage.attachments',{caption: '', link_to: '', url: ''});
      },
      _removeHomePageAttachment: function(e){
        this.splice('homePage.attachments', e.model.index, 1);
      },
      _addService: function(e){
        // console.log('_addService');
        this.push('servicesPage.items', {image: '', name: '', slug:'', detail_images: [], detail_items: []});
      },
      _removeService: function(e){
        // console.log('_removeService idx',e.model.index);
        this.splice('servicesPage.items', e.model.index, 1)
      },
      _addAboutPageDescriptionItem: function(e){
        this.push('aboutPage.items', {description: '', title: ''})
      },
      _removeAboutPageDescriptionItem: function(e){
        this.splice('aboutPage.items', e.model.index, 1);
      },
      _addServicesDetailImage: function(e){
        // console.log('_addDetailImage e.model.index',e.model.index,' e.model.page:',e.model.page);
        this.push('servicesPage.items.'+e.model.index+'.detail_images', '');
      },
      _removeServicesDetailImage: function(e){
        var _servicesPageIdx = e.target.getAttribute('idx');
        // console.log('_removeServicesDetailImage idx attr?',_servicesPageIdx);
        this.splice('servicesPage.items.'+_servicesPageIdx+'.detail_images', e.model.index, 1);
      },
      _addServicesDescriptionItem: function(e){
        // console.log('_addServicesDescriptionItem: e.model.index',e.model.index);
        this.push('servicesPage.items.'+e.model.index+'.detail_items', {description: '', name: ''});
      },
      _removeServicesDescriptionItem: function(e){
        // console.log('_removeServicesDescriptionItem: this.servicesPage.items.indexOf(e.model.item):',this.servicesPage.items.indexOf(e.model.item));
        this.splice('servicesPage.items.'+this.servicesPage.items.indexOf(e.model.item)+'.detail_items',e.model.index, 1);
      },
      _isServices: function(_pageName){
        return _pageName == 'services';
      },
      _isVendorGoods: function(_pageName){
        return _pageName.match(/vendor/i);
      },
      _isQuote: function(_pageName){
        return _pageName.match(/quote/i);
      },
      _isImages: function(_pageName){
        return _pageName.match(/images/i);
      },
      _servicePageItemIndex: function(_item){
        return this.servicesPage.items.indexOf(_item);
      },
      _dataFileSelected: function(e){
        this.set('dataLoading', true);
        // console.log('_dataFileSelected e:',e);
        // console.log('val:',this.vendorDatafiles[e.target.selected-1]);
        this.set('admin.selectedVendorDatafile', this.vendorDatafiles[e.target.selected-1]) 
        this._fetchVendorGoods(this.vendorDatafiles[e.target.selected-1]);
      },
      _saveVendorData: function(){
        // console.log('admin.selectedVendorDatafile:',this.admin.selectedVendorDatafile);

        // var _jsonOut = editor.get();
        //console.log('wooo vendor data: ', _.filter(this.vendorgoods, {selected: true}) );
        console.log('_saveVendorData this.selectedVendorGoods:',this.selectedVendorGoods);

        this.$.saveVendorGoods.body = JSON.stringify({vendorgoods: this.selectedVendorGoods });
        
        this.$.saveVendorGoods.generateRequest();

      },
      _handlesaveVendorGoodsResponse: function(e){
        // console.log('_handlesaveVendorGoodsResponse e:',e);
      },
      _handlesaveVendorGoodsError: function(e){
        // console.log('_handlesaveVendorGoodsError e:',e);
      },
      _showSelected: function(){
        this.set('filteredVendorgoods', this.selectedVendorGoods);
      },
      _applyVendorDataFilter: function(){
        var _filteredGoodz = [];
        try{
          var _dFilter = this.admin.VendorDataFilter;
          if(this.admin.VendorDataFilter.match('=')){
             _filteredGoodz = _.filter(this.vendorgoods, function(_good){ return _good[_dFilter.split('=')[0]].toLowerCase().indexOf(_dFilter.split('=')[1]) != -1; });
          }else if(this.admin.VendorDataFilter.match('~')){
            _filteredGoodz = _.filter(this.vendorgoods, function(_good){ return _good[_dFilter.split('~')[0]].match(_dFilter.split('~')[1]); });
            
          }else if(this.admin.VendorDataFilter.match('>')){
            _filteredGoodz = _.filter(this.vendorgoods, function(_good){ return _good[_dFilter.split('>')[0]] > _dFilter.split('>')[1]; });
          }else if(this.admin.VendorDataFilter.match('<')){
            _filteredGoodz = _.filter(this.vendorgoods, function(_good){ return _good[_dFilter.split('<')[0]] < _dFilter.split('<')[1]; });
          }else{
            _filteredGoodz = _.filter(this.vendorgoods, function(_good){ return _good.title.toLowerCase().indexOf(_dFilter) != -1; });
          }
        }catch(err){
          //o noz!
          // console.log('o noz _applyVendorDataFilter caught err:',err);
        }

        if(_filteredGoodz.length > 0){

          // console.log('_filteredGoodz.length:',_filteredGoodz.length,' _dFilter:',_dFilter);
          // editor.set(_filteredGoodz);
          this.set('filteredVendorgoods',_filteredGoodz)
        }else{
          // console.log('no filtered itemz');
          // editor.set(this.vendorgoods);
          this.set('filteredVendorgoods',this.vendorgoods)
        }
        
        

      },
      _filteredGoodsLength(_filteredVendorgoods){
        return '('+_filteredVendorgoods.length+')';
      },
      _openDialog: function(e){
        this.set('vendorItem', e.model.item);
        this.$.vendorGoodsInfo.open();
      },
      _colorPricesForName: function(_items, _name){
        var retArr = [];
        _.each(_items.color_prices, function(_color_prices){
          if(_.any(_.flatten(_color_prices[0]), function(item){return item == _name})){
            retArr = _.map(_color_prices, function(clr_price){ return {size: _.flatten(clr_price)[0], price: _.flatten(clr_price)[1]} });
            retArr.shift();
          }
        });
        return retArr;
      },
      _vendorGoodSelected: function(e){
        // console.log('_vendorGoodSelected: e.target.checked:',e.target.checked,'  e.model.item',e.model.item);
        if(e.target.checked){
          if(this.selectedVendorGoods.indexOf(e.model.item) == -1){
            this.push('selectedVendorGoods',e.model.item);
          }
        }else{
          if(this.selectedVendorGoods.indexOf(e.model.item) != -1){
            this.splice('selectedVendorGoods', e.model.item, 1);
          }
        }
      },
      _selectAllFilteredGoods: function(e){
        
        var _goodz = this.filteredVendorgoods;
        console.log('_selectAllFilteredGoods e.target.checked:',_goodz);
        if(e.target.checked){
          this.set('filteredVendorgoods',[]);
          console.log('fuck this.filteredVendorgoods:',this.filteredVendorgoods);
          
          this.async(function(){
            _this = this;
            this.set('filteredVendorgoods', _.each(_goodz, function(o) {
              o.selected = true;
              if(_this.selectedVendorGoods.indexOf(o) == -1){
                _this.push('selectedVendorGoods',o);
              }
            }));
           },1);
         
          // console.log('tadafuck this.filteredVendorgoods:',this.filteredVendorgoods);
        }else{
          this.set('filteredVendorgoods',[]);
          this.async(function(){
            _this = this;
            this.set('filteredVendorgoods', _.each(_goodz, function(o) {
              o.selected = false;
              if(_this.selectedVendorGoods.indexOf(o) != -1){
                _this.splice('selectedVendorGoods', o, 1);
              }
            }));
          },1);
        }
      },
      _imageSelected: function(e){
        console.log('_imageSelected e.model.item:',e.model.item);
      },
      ready: function(){

        if(window.location.hash.replace(/#/,'').length > 5){
          // console.log('lookz like we have a quoteID! ',window.location.hash.replace(/#/,''));
          this.async(function(){
            this.set('quoteID', '');
            this.set('admin.quoteID', window.location.hash.replace(/#/,''));
          }, 200);
          
        }

        //json editor for vendor goods
        // container = this.$.jsoneditor;
        // options = {};
        // editor = new JSONEditor(container, options);

        //file upload
        var input = this.$.rebelImages;
        var _this = this;
        input.addEventListener('change', function () {
          var file = input.files[0]; // file is a Blob

          _this.$.rebelImagesSpinner.active = true;

          var params = {};
          params["filename"] = file.name;
          _this.$.ajaxCreateImage.params = params;

          var formData = new FormData();
          formData.append('file', file);

          _this.$.ajaxCreateImage.body = formData;
          _this.$.ajaxCreateImage.generateRequest();


        });


        //prevent scrolling when dialog is open.
        // this.$.vendorGoodsInfo.addEventListener('opened-changed', function(e){
        //   console.log('vendorGoodsInfo e:',e.opened);
        //   if(e.opened) {
        //     Polymer.IronDropdownScrollManager.pushScrollLock(this.$.vendorGoodsInfo);
        //   } else {
        //     Polymer.IronDropdownScrollManager.removeScrollLock(this.$.vendorGoodsInfo);
        //   }
        // });


      }


    });

  </script>

</dom-module>
