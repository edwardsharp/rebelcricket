<link rel="import" href="../bower_components/polymer/polymer.html">
<!-- <link rel="import" href="rebelcricket-pouchdb.html"> -->
<link rel="import" href="../bower_components/app-pouchdb/pouchdb.html">
<link rel="import" href="../bower_components/app-pouchdb/app-pouchdb-database-behavior.html">
<link rel="import" href="../bower_components/app-pouchdb/app-pouchdb-index.html">
<link rel="import" href="../bower_components/app-pouchdb/app-pouchdb-query.html"> 
<link rel="import" href="../bower_components/app-pouchdb/app-pouchdb-document.html">
<!-- <link rel="import" href="../bower_components/app-pouchdb/app-pouchdb-conflict-resolution.html"> -->
<link rel="import" href="../bower_components/iron-grid/iron-grid.html">
<link rel="import" href="../bower_components/paper-toggle-button/paper-toggle-button.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../bower_components/paper-swatch-picker/paper-swatch-picker.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-input/paper-textarea.html">
<link rel="import" href="../bower_components/paper-checkbox/paper-checkbox.html">

<script src="../bower_components/pouchdb/dist/pouchdb.js"></script>
<script src="../bower_components/pouchdb-find/dist/pouchdb.find.js"></script>

<dom-module id="rebelcricket-order">
  <template>
    <style is="custom-style" include="rebelcricket-common-styles">    

      paper-button.custom {
        background: white;
        color: #333;
      }

      paper-button.custom:hover {
        background: #333;
        color: white;
      }

      paper-button[disabled] {
        background: #333;
        color: gray;
      }

      paper-input, paper-textarea {
        width: 100%;
      }

      hr {
        width: 97%;
      }

      .fit {
        position: initial!important;
      }

      .center{
        text-align: center;
      }

      .flex-wrap {
        @apply(--layout-horizontal);
        @apply(--layout-wrap);
      }

      .flex-wrap div {
        min-width: 200px;
      }

     

      @media (max-width: 767px) {


      }

    </style>
 <!--    <app-route
        route="[[route]]"
        pattern="/:order_id"
        data="{{routeData}}"></app-route> -->

    <app-pouchdb-document
      db-name="http://localhost:5984/orders"
      doc-id="{{orderID}}"
      data="{{order}}">
    </app-pouchdb-document>

 <!--      <app-pouchdb-document
        db-name="http://localhost:5984/cats"
        doc-id="mydoc"
        data="{{mydoc}}">
      </app-pouchdb-document> -->

  

    <div class="container">
   <!--    <header class="center">
        <h1 class="rebelcricket-header">Order</h1>
      </header> -->

      <iron-grid-container>
          <iron-grid>
            <div class="xs7">
              <template is="dom-repeat" items="{{order.header.items0}}">
                <div class$="[[item.col]]">
                  <paper-input name="{{item.key}}" label="{{item.label}}" value="{{item.value}}"></paper-input>
                </div>
              </template>
            </div>

            <div class="xs5">
              <template is="dom-repeat" items="{{order.header.items1}}">
                <div class$="[[item.col]]">
                  <paper-input name="{{item.key}}" label="{{item.label}}" value="{{item.value}}"></paper-input>
                </div>
              </template>
            </div>
          </iron-grid>
          <iron-grid>

            <div class="xs7">
              <div class="xs8">[[order.header.label0]]</div>
              <div class="xs4">[[order.header.label1]]</div>
            </div>
            <div class="xs5">
              <template is="dom-repeat" items="{{order.header.items2}}">
                <div class$="[[item.col]]">
                  <paper-input name="{{item.key}}" label="{{item.label}}" value="{{item.value}}"></paper-input>
                </div>
              </template>
            </div>
          </iron-grid>
          <iron-grid>
            <div class="xs5 offset-xs7">
              <template is="dom-repeat" items="{{order.header.items3}}">
                <div class$="[[item.col]]">
                  <paper-input name="{{item.key}}" label="{{item.label}}" value="{{item.value}}"></paper-input>
                </div>
              </template>
            </div>

          </iron-grid>
          <iron-grid>
            <div class="xs12">
              <hr>
            </div>
          </iron-grid>
          <iron-grid>
            <div class="xs12 s6">
              <div class="label s12">
                [[order.job.label]]
              </div>
              <template is="dom-repeat" items="{{order.job.items}}">
                <div class$="[[item.col]]">
                  <template is="dom-if" if="{{_isInput(item.type)}}">
                    <paper-input name="{{item.key}}" label="{{item.label}}" value="{{item.value}}"></paper-input>
                  </template>
                  <template is="dom-if" if="{{_isTextarea(item.type)}}">
                    <paper-textarea rows="{{item.rows}}" name="{{item.key}}" label="{{item.label}}" value="{{item.value}}"></paper-textarea>
                  </template>
                </div>
              </template>
            </div>
            <div class="xs12 m6">
              <div class="label xs12">
                [[order.client_contact_information.label]]
              </div>
              <template is="dom-repeat" items="{{order.client_contact_information.items}}">
                <div class$="[[item.col]]">
                  <paper-input name="{{item.key}}" label="{{item.label}}" value="{{item.value}}"></paper-input>
                </div>
              </template>
            </div>

            <div class="xs12 s6">
              <div class="label xs12">
                [[order.job_completion_and_shipping.label]]
              </div>
              <template is="dom-repeat" items="{{order.job_completion_and_shipping.items}}">
                <div class$="[[item.col]]">
                  <template is="dom-if" if="{{_isInput(item.type)}}">
                    <paper-input name="{{item.key}}" label="{{item.label}}" value="{{item.value}}"></paper-input>
                  </template>
                  <template is="dom-if" if="{{_isTextarea(item.type)}}">
                    <paper-textarea rows="{{item.rows}}" name="{{item.key}}" label="{{item.label}}" value="{{item.value}}"></paper-textarea>
                  </template>
                  <template is="dom-if" if="{{_isCheckbox(item.type)}}">
                    <paper-checkbox checked="{{item.value}}"> {{item.label}}</paper-checkbox>
                  </template>
                </div>
              </template>
            </div>

          </iron-grid>
          <br>
          <iron-grid>
            <template is="dom-repeat" items="{{order.line_items.items}}">
              <template is="dom-repeat" items="{{item}}">
                <div class$="[[item.col]]">
                  <template is="dom-if" if="{{_isInput(item.type)}}">
                    <paper-input name="{{item.key}}" label="{{item.label}}" value="{{item.value}}" readonly$="{{item.readonly}}"></paper-input>
                  </template>
                </div>
              </template>
            </template>
            <div class="xs12">
              &plus;
            </div>
          </iron-grid>
          <br>
          <iron-grid>
            <div class="xs12 s6 l4">
              <template is="dom-repeat" items="{{order.graphic.items}}">
                <template is="dom-repeat" items="{{item.top}}">
                  <div class$="[[item.col]]">
                    <template is="dom-if" if="{{_isInput(item.type)}}">
                      <paper-input name="{{item.key}}" label="{{item.label}}" value="{{item.value}}" readonly$="{{item.readonly}}"></paper-input>
                    </template>
                  </div>
                </template>

                <template is="dom-repeat" items="{{item.color_mesh_print}}">
                  <div class$="[[item.col]]">
                    <template is="dom-if" if="{{_isInput(item.type)}}">
                      <paper-input name="{{item.key}}" label="{{item.label}}" value="{{item.value}}"></paper-input>
                    </template>
                  </div>
                </template>
                <div class="xs12">
                  &plus;
                </div>
                <template is="dom-repeat" items="{{item.bottom}}">
                  <div class$="[[item.col]]">
                    <template is="dom-if" if="{{_isInput(item.type)}}">
                      <paper-input name="{{item.key}}" label="{{item.label}}" value="{{item.value}}"></paper-input>
                    </template>
                  </div>
                </template>
              </template>

              <div class="xs12">
                &plus;
              </div>
            </div>
          </iron-grid>
          
      </iron-grid-container>



         <!--  <paper-dropdown-menu label="Style" on-iron-select="_styleSelected">
            <paper-listbox class="dropdown-content" selected="0">
              <paper-item value="crew">Crew</paper-item>
              <paper-item value="womens_crew">Women's Crew</paper-item>
              <paper-item value="hoodie">Hoodie</paper-item>
              <paper-item value="longsleeve">Long Sleeve</paper-item>
            </paper-listbox>
          </paper-dropdown-menu> -->
        <!--   <paper-swatch-picker color="{{designElementColor}}" column-count=4 color-list='["#000000", "#65a5f2", "#83be54", "#f0d551", "#e5943c", "#a96ddb", "#B20000", "#ffffff"]'></paper-swatch-picker> -->
         

          <!-- <template is="dom-repeat" items="{{designImages}}">
            <template is="dom-repeat" items="{{_attachmentKeys(item._attachments)}}" as="attachment">
              <img src="http://localhost:5984/cats/{{item._id}}/{{ attachment }}" height="50" width="50">
            </template>
          </template>
          <br> -->

          
   
    </div>

  </template>

  <script>
  generateGUID = (typeof(window.crypto) != 'undefined' && 
                typeof(window.crypto.getRandomValues) != 'undefined') ?
  function() {
      // If we have a cryptographically secure PRNG, use that
      // http://stackoverflow.com/questions/6906916/collisions-when-generating-uuids-in-javascript
      var buf = new Uint16Array(8);
      window.crypto.getRandomValues(buf);
      var S4 = function(num) {
          var ret = num.toString(16);
          while(ret.length < 4){
              ret = "0"+ret;
          }
          return ret;
      };
      return (S4(buf[0])+S4(buf[1])+"-"+S4(buf[2])+"-"+S4(buf[3])+"-"+S4(buf[4])+"-"+S4(buf[5])+S4(buf[6])+S4(buf[7]));
  }
  :
  function() {
      // Otherwise, just use Math.random
      // http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript/2117523#2117523
      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
          var r = Math.random()*16|0, v = c == 'x' ? r : (r&0x3|0x8);
          return v.toString(16);
      });
  };

  Polymer({
    is: 'rebelcricket-order',
    behaviors: [
      Polymer.AppPouchDBDatabaseBehavior
    ],
    properties: {
      order: {
        type: Object,
        notify: true,
        value: function(){
          return {
            header: {
              label0: 'REBEL CRICKET SCREEN PRINTS',
              label1: 'WORK ORDER',
              items0: [
                {key: 'estimate_number', label: 'estimate #', type: 'text', col: 'xs12 s6'},
                {key: 'invoice_number', label: 'invoice#', type: 'text', col: 'xs12 s6'}
              ],
              items1: [
                {key: 'todays_date', label: 'TODAY\'S DATE', value: this._now(), type: 'text', col: 'xs12'},
              ],
              items2: [
                {key: 'purchase_order_number', label: 'PURCHASE ORDER #', type: 'text', col: 'xs12'},
              ],
              items3: [
                {key: 'in_hands_date', label: 'IN-HANDS DATE', type: 'text', col: 'xs12'}
              ]
            },
            job: {
              label: 'JOB',
              items: [
                {key: 'job_name', label: 'JOB', type: 'text', col: 'xs8'},
                {key: 'from_po', label: 'From P.O.#', type: 'text', col: 'xs4'},
                {key: 'art_notes', label: 'ART NOTES', type: 'textarea', col: 'xs12', rows: 4},
                {key: 'printers_notes', label: 'Printer\'s Notes', type: 'textarea', col: 'xs12', rows: 2}
              ]
            },
            client_contact_information: {
              label: 'CLIENT CONTACT INFORMATION',
              items: [
                {key: 'client_name', label: 'Name', type: 'text', col: 'xs12'},
                {key: 'client_phone', label: 'Phone', type: 'text', col: 'xs12'},
                {key: 'client_email', label: 'Email', type: 'text', col: 'xs12'}
              ]
            },
            job_completion_and_shipping: {
              label: 'COMPLETION & SHIPPING INSTRUCTIONS',  
              items: [
                {key: 'call_when_complete', label: 'Call when complete', type: 'checkbox', value: false, col: 'xs6'},
                {key: 'will_call', label: 'Will Call', type: 'checkbox', value: false, col: 'xs3'},
                {key: 'ship_via', label: 'Ship', type: 'checkbox', value: false, col: 'xs3'},
                {key: 'ship_via_txt', label: 'Ship Via', type: 'text', col: 'xs6'},
                {key: 'ship_by_date', label: 'Ship by date', type: 'text', col: 'xs6'},
                {key: 'ship_to', label: 'Ship to', type: 'textarea', col: 'xs12', rows: 3}
              ]
            },
            line_items: {
              label: 'LINE ITEMS',
              items: [
                [
                  {key: 'brand', label: 'BRAND', type: 'text', col: 'xs4 s2 m1'},
                  {key: 'style', label: 'STYLE', type: 'text', col: 'xs4 s2 m1'},
                  {key: 'color', label: 'COLOR', type: 'text', col: 'xs4 s2 m1'},
                  {key: 'xs', label: 'XS', type: 'number', col: 'xs2 s2 m1'},
                  {key: 'sm', label: 'SM', type: 'number', col: 'xs2 s2 m1'},
                  {key: 'md', label: 'MD', type: 'number', col: 'xs2 s2 m1'},
                  {key: 'lg', label: 'LG', type: 'number', col: 'xs2 s2 m1'},
                  {key: 'xl', label: 'XL', type: 'number', col: 'xs2 s2 m1'},
                  {key: '2xl', label: '2XL', type: 'number', col: 'xs2 s2 m1'},
                  {key: '3xl', label: '3XL', type: 'number', col: 'xs4 s2 m1'},
                  {key: 'other', label: 'OTHER', type: 'number', col: 'xs4 s2 m1'},
                  {key: 'line_total', label: 'TOTAL', type: 'number', col: 'xs4 s2 m1', readonly: true},
                ]
              ]
            },
            graphic: {
              items: [{
                top: [
                  {key: 'graphic_name', label: 'Graphic', type: 'text', col: 'xs12'},
                  {key: 'new_setup', label: 'New setup', type: 'text', col: 'xs6'},
                  {key: 'resets', label: 'Resets', type: 'number', col: 'xs6'},
                  {key: 'placement', label: 'Placement', type: 'text', col: 'xs6'},
                  {key: 'line_items_total', label: 'Total', type: 'number', col: 'xs6', readonly: true},
                  {key: 'color_changes', label: 'Color changes', type: 'number', col: 'xs12'},
                  {key: 'pricing_group', label: 'Pricing group', type: 'text', col: 'xs6'},
                  {key: 'flash', label: 'Flash', type: 'text', col: 'xs6'}
                ],
                color_mesh_print: [ 
                  {key: 'graphic_color', label: 'COLOR', type:'text', col: 'xs4'},
                  {key: 'mesh', label: 'MESH', type:'text', col: 'xs4'},
                  {key: 'print_order', label: 'PRINT ORDER', type:'text', col: 'xs4'}
                ],
                bottom: [
                  {key: 'setup_start', label: 'Setup start', type: 'text', col: 'xs12'},
                  {key: 'setup_complete', label: 'Setup complete', type: 'text', col: 'xs12'},
                  {key: 'approved_by', label: 'Approved by', type: 'text', col: 'xs12'},
                  {key: 'print_start', label: 'Print start', type: 'text', col: 'xs12'},
                  {key: 'breaks', label: 'Break/s', type: 'text', col: 'xs12'},
                  {key: 'print_end', label: 'Print end', type: 'text', col: 'xs12'}
                ]
              }]
            }
          }
        }
      },
      orderID: {
        type: String,
        notify: false,
        value: function() { 
          if(window.location.hash === ''){
            window.location.hash = generateGUID();
          }
          return window.location.hash.replace(/#/,'');
        }
      }
    },
    _now: function(){
      var date = new Date();
      return ("0"+(date.getMonth() + 1)).slice(-2) + "/" + ("0"+date.getDate()).slice(-2) + "/" +  date.getFullYear();
    },
    _isInput: function(type){
      return type == 'text' || type == 'number';
    },
    _isTextarea: function(type){
      return type == 'textarea';
    },
    _isCheckbox: function(type){
      return type == 'checkbox';
    },
    ready: function(){

      console.log('orderID:',this.orderID);

      console.log('this.order',this.order);

      //file upload
      // var db = new PouchDB('http://localhost:5984/orders');

      // var input = this.$.catFile;
      // var _this = this;
      // input.addEventListener('change', function () {
      //   var file = input.files[0]; // file is a Blob

      //   db.putAttachment(this.orderID, file.name, file, file.type).then(function (result) {
      //     // handle result
      //     // _this._addImageToCanvas('http://localhost:5984/cats/'+file.name+'/'+file.name);
      //   }).catch(function (err) {
      //     console.log(err);
      //   });

      // });

    }


  });


  </script>
</dom-module>
